"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7684],{4829:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"dns/validation","title":"DNS Domain Validation (dns-01)","description":"Why use DNS Validation?","source":"@site/docs/dns/validation.md","sourceDirName":"dns","slug":"/dns/validation","permalink":"/docs/dns/validation","draft":false,"unlisted":false,"editUrl":"https://github.com/webprofusion/certify-docs/edit/master/docs/dns/validation.md","tags":[],"version":"current","frontMatter":{"id":"validation","title":"DNS Domain Validation (dns-01)"},"sidebar":"commonDocsSidebar","previous":{"title":"HTTP Domain Validation (http-01)","permalink":"/docs/http-validation"},"next":{"title":"Deployment Tasks","permalink":"/docs/deployment/tasks_intro"}}');var s=o(4848),a=o(8453);const t={id:"validation",title:"DNS Domain Validation (dns-01)"},r=void 0,d={},l=[{value:"Why use DNS Validation?",id:"why-use-dns-validation",level:2},{value:"How to use DNS Validation",id:"how-to-use-dns-validation",level:2},{value:"Certify DNS",id:"certify-dns",level:3},{value:"DNS API Providers",id:"dns-api-providers",level:3},{value:"Propagation Delay Seconds",id:"propagation-delay-seconds",level:3},{value:"CNAME Delegation",id:"cname-delegation",level:3},{value:"Domain Match Rules",id:"domain-match-rules",level:3},{value:"Other DNS Validation Methods",id:"other-dns-validation-methods",level:2},{value:"ACME DNS",id:"acme-dns",level:3},{value:"DNS Scripting",id:"dns-scripting",level:3},{value:"Manual DNS",id:"manual-dns",level:3},{value:"Common Issues",id:"common-issues",level:2},{value:"DNS domain validations suddenly failing",id:"dns-domain-validations-suddenly-failing",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"why-use-dns-validation",children:"Why use DNS Validation?"}),"\n",(0,s.jsxs)(n.p,{children:["To request a certificate from Let's Encrypt (or any Certificate Authority), you need to provide some kind of proof that you are entitled to receive the certificate for given domain(s). Let's Encrypt supports two methods of validation to prove control of your domain, ",(0,s.jsx)(n.code,{children:"http-01"})," (",(0,s.jsx)(n.a,{href:"/docs/http-validation",children:"validation over HTTP"}),") and ",(0,s.jsx)(n.code,{children:"dns-01"})," (validation over DNS)."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsxs)(n.strong,{children:["Wildcard domain certificates (those covering ",(0,s.jsx)(n.code,{children:"*.yourdomain.com"}),") can only be requested using DNS validation."]})," DNS Validation is also especially useful if the domains you are trying to get certification for are not public websites, or cannot serve http requests on port 80."]}),"\n",(0,s.jsx)(n.h2,{id:"how-to-use-dns-validation",children:"How to use DNS Validation"}),"\n",(0,s.jsx)(n.p,{children:"In order to validate your control of your domains to the certificate authority you will be required to create a specified TXT record in your domain's DNS zone."}),"\n",(0,s.jsx)(n.p,{children:"To do this you may need to get the API credentials for the (hosted) DNS from your DNS providers control panel, store these credentials in the app then select them to be used for specific certificate requests. DNS credentials are encrypted at rest using Windows DAPI, but where possible you should use limited privilege credentials."}),"\n",(0,s.jsx)(n.p,{children:"If your DNS provider (or custom DNS setup) does not have an API we can talk to, you can write your own DNS update script or use the Manual DNS option (the request pauses while you manually update DNS)."}),"\n",(0,s.jsx)(n.h3,{id:"certify-dns",children:"Certify DNS"}),"\n",(0,s.jsxs)(n.p,{children:["Certify DNS is a cloud hosted version of the acme-dns standard (CNAME delegation of acme challenge TXT records to a dedicated challenge response service). This service can be enabled through the ",(0,s.jsx)(n.a,{href:"https://certifytheweb.com",children:"https://certifytheweb.com"})," License Keys tab when signed in. The service is compatible with most existing ",(0,s.jsx)(n.em,{children:"acme-dns"})," clients so it can be used with other ACME clients on all operating systems. Read more about ",(0,s.jsx)(n.a,{href:"/docs/dns/providers/certifydns",children:"Certify DNS"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"dns-api-providers",children:"DNS API Providers"}),"\n",(0,s.jsx)(n.p,{children:"Current Built-In DNS API providers include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["ACME DNS (see below), Aliyun *, ",(0,s.jsx)(n.a,{href:"/docs/dns/providers/awsroute53",children:"AWS Route53"}),", ",(0,s.jsx)(n.a,{href:"/docs/dns/providers/azuredns",children:"Azure DNS"}),", ",(0,s.jsx)(n.a,{href:"/docs/dns/providers/cloudflare",children:"Cloudflare"}),", ",(0,s.jsx)(n.a,{href:"/docs/dns/providers/dnsmadeeasy",children:"DNS Made Easy"}),", ",(0,s.jsx)(n.a,{href:"/docs/dns/providers/godaddy",children:"GoDaddy"}),", Microsoft DNS *, IONOS *, ",(0,s.jsx)(n.a,{href:"/docs/dns/providers/ovh",children:"OVH"})," *, Simple DNS Plus *, TransIP *"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"* marked providers are contributed and tested by users."})}),"\n",(0,s.jsxs)(n.p,{children:["In addition we implement a number of DNS providers courtesy of the Posh-ACME: ",(0,s.jsx)(n.a,{href:"https://github.com/rmbolger/Posh-ACME",children:"https://github.com/rmbolger/Posh-ACME"})," project. If you encounter any issues with these you should verify they work normally within Posh-ACME and then raise an issue on our ",(0,s.jsx)(n.a,{href:"https://github.com/webprofusion/certify",children:"github page"})," :"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Akamai",children:"Akamai"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/AutoDNS",children:"AutoDNS"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/All-Inkl",children:"All-Inkl"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/ClouDNS",children:"ClouDNS"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Combell",children:"Combell"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Constellix",children:"Constellix"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/DNSPod",children:"DNSPod"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/DNSimple",children:"DNSimple"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/DomainOffensive",children:"DomainOffensive"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/DeSEC",children:"deSEC"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/DOcean",children:"DigitalOcean"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Dreamhost",children:"Dreamhost"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Dynu",children:"Dynu"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/EasyDNS",children:"EasyDNS"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Gandi",children:"Gandi"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/GCloud",children:"Google Cloud"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Hetzner",children:"Hetzner"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/HurricaneElectric",children:"Hurricane Electric"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Infoblox",children:"Infoblox"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/IBMSoftLayer",children:"IBM Cloud/SoftLayer"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/ISPConfig",children:"ISPConfig"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Linode",children:"Linode"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Loopia",children:"Loopia"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/LuaDns",children:"LuaDns"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/NameCom",children:"name.com"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Namecheap",children:"Namecheap"}),"\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/NS1",children:"NS1"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/PointDNS",children:"PointDNS"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Rackspace",children:"Rackspace"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/RFC2136",children:"RFC2136"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Selectel",children:"Selectel"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Simply",children:"Simply"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/TotalUptime",children:"TotalUptime"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/UKFast",children:"UKFast"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Yandex",children:"Yandex"}),",\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Zilore",children:"Zilore"}),"\n",(0,s.jsx)(n.a,{href:"https://poshac.me/docs/v4/Plugins/Zonomi",children:"Zonomi"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"If you change API credentials, you need to replace the credential settings in Certify under 'Settings > Stored Credentials' to ensure renewals keep working. Once saved, there is also a 'Test' option so you can try out the credentials to check they still work."})}),"\n",(0,s.jsx)(n.h3,{id:"propagation-delay-seconds",children:"Propagation Delay Seconds"}),"\n",(0,s.jsxs)(n.p,{children:["When using DNS validation, the certificate authority will check your DNS TXT record using your authoritative nameserver to see if they agree on the expected value of the corresponding ",(0,s.jsx)(n.code,{children:"_acme-challenge"})," record for each domain/subdomain identifier. When the TXT record is updated it can often take up to a minute or two for all your nameservers to agree, we refer to the time we wait to allow for this as ",(0,s.jsx)(n.em,{children:"Propagation Delay"}),". The default propagation delay is 60 seconds, but you can increase this if you are having trouble with validation. If you are using a DNS provider which has a very long propagation delay you may need to increase this value e.g. to 300 seconds (5 minutes)."]}),"\n",(0,s.jsx)(n.h3,{id:"cname-delegation",children:"CNAME Delegation"}),"\n",(0,s.jsxs)(n.p,{children:["An optional advanced approach to DNS validation which removes the need to update your primary domain DNS is to use CNAME delegation, this is where you create an ",(0,s.jsx)(n.code,{children:"_acme-challenge.yourdomain.com"})," CNAME record for each domain/subdomain and point it at a corresponding TXT record in another DNS zone. This allows you to have a dedicated domain or subdomain which specifically handles DNS challenge requests (because it can be automated)."]}),"\n",(0,s.jsxs)(n.p,{children:["In the Authorization configuration UI, you can specify the ",(0,s.jsx)(n.code,{children:"CNAME Delegation Rule"})," for each authorization configuration."]}),"\n",(0,s.jsxs)(n.p,{children:["The rule format is: ",(0,s.jsx)(n.code,{children:"*.source.domain:*.destination.domain"}),", you can specify multiple rules by separating rules with ",(0,s.jsx)(n.code,{children:";"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["So if for example your website ",(0,s.jsx)(n.code,{children:"example.com"})," has names ",(0,s.jsx)(n.code,{children:"example.com"})," and ",(0,s.jsx)(n.code,{children:"www.example.com"})," these would normally require a challenge TXT record be automatically created for each entry e.g. ",(0,s.jsx)(n.code,{children:"_acme-challenge.example.com"})," and ",(0,s.jsx)(n.code,{children:"_acme-challenge.www.example.com"}),". In this example we could redirect those as CNAME entries to a dedicated zone such as ",(0,s.jsx)(n.code,{children:"auth.example.org"}),"."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Configure all of the settings in order to update the target domain (instead of the original domain) and set your ",(0,s.jsx)(n.code,{children:"CNAME Delegation Rule"})," as ",(0,s.jsx)(n.code,{children:"*.example.com:*.auth.example.org"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["You will then also need an ",(0,s.jsx)(n.code,{children:"_acme-challenge"})," CNAME in your original domain setup to point to delegated domain, for each domain/subdomain (e.g. ",(0,s.jsx)(n.code,{children:"_acme-challenge.example.com"})," pointing to ",(0,s.jsx)(n.code,{children:"_acme-challenge.auth.example.org"})," and ",(0,s.jsx)(n.code,{children:"_acme-challenge.www.example.com"})," pointing to ",(0,s.jsx)(n.code,{children:"_acme-challenge.www.auth.example.org"}),")."]}),"\n",(0,s.jsx)(n.li,{children:"The app will create/update the target TXT record and values, using the DNS credentials/API selection you have specified for the target domain/DNS zone."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["It's also possible to redirect multiple sources to one destination subdomain using a non-wildcard target e.g. a rule definition of ",(0,s.jsx)(n.code,{children:"*.example.com:auth.example.org"})," would translate ",(0,s.jsx)(n.code,{children:"_acme-challenge.www.example.com"})," to ",(0,s.jsx)(n.code,{children:"_acme-challenge.auth.example.org"}),", ignoring the subdomain. This means all of your TXT updates can use the same TXT record but support for this will vary by DNS provider."]}),"\n",(0,s.jsx)(n.h3,{id:"domain-match-rules",children:"Domain Match Rules"}),"\n",(0,s.jsxs)(n.p,{children:["For certificates that require multiple authorizations across different domain (e.g. different DNS providers/zones or a mix of HTTP and DNS validation) you can use the ",(0,s.jsx)(n.code,{children:"Domain Match Rule"})," to specify which domains/subdomains should be matched for the given authorization configuration. These are optional and ",(0,s.jsx)(n.em,{children:"only"})," used if you have multiple authorization configurations for the same certificate. To match all (first level) subdomains of a domain use a wildcard ",(0,s.jsx)(n.code,{children:"*.example.com"})," or to match only a single specific domain/subdomain identifier use ",(0,s.jsx)(n.code,{children:"subdomain.example.com"}),", multiple rules can be supplied as semicolon separated."]}),"\n",(0,s.jsxs)(n.p,{children:["Note that ",(0,s.jsx)(n.code,{children:"*.example.com"})," will ",(0,s.jsx)(n.em,{children:"not"})," match a further subdomain level such as ",(0,s.jsx)(n.code,{children:"something.subdomain.example.com"}),". To match multiple subdomains either explicitly or as a wildcard you can use a semicolon separated list e.g.",(0,s.jsx)(n.code,{children:"*.example.com;*.subdomain.example.com;www.something.example.com"}),". You can use the Preview tab to see which authorization configurations will match which identifiers, if an identifier is not matched the app will fall back to HTTP validation for that identifier."]}),"\n",(0,s.jsx)(n.h2,{id:"other-dns-validation-methods",children:"Other DNS Validation Methods"}),"\n",(0,s.jsx)(n.p,{children:"You can alternatively use the following methods to manage your DNS TXT records:"}),"\n",(0,s.jsx)(n.h3,{id:"acme-dns",children:"ACME DNS"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/joohoi/acme-dns",children:"acme-dns"})," is a system to automatically manage TXT record values on behalf of your domain ",(0,s.jsx)(n.strong,{children:"just for challenge validation"}),". This is probably the easiest method if you have a trusted acme-dns server you can use, this also avoids storing powerful DNS admin credentials on your server. Find out more on ",(0,s.jsx)(n.a,{href:"/docs/dns/providers/acme-dns",children:"how to use acme-dns"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"dns-scripting",children:"DNS Scripting"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"/docs/dns/providers/scripting",children:"DNS Scripting"})," involves providing your own custom script to update/delete TXT records in your DNS using a .bat file which can then optionally call python, node scripts etc."]}),"\n",(0,s.jsx)(n.h3,{id:"manual-dns",children:"Manual DNS"}),"\n",(0,s.jsx)(n.p,{children:"If you are just experimenting with wildcard domains you may opt to use manual DNS updates (editing manually via your DNS control panel)."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"This is the least recommended option as you will need to update this for every renewal."})}),"\n",(0,s.jsxs)(n.p,{children:["This method can also be extremely confusing when requesting a single cert for ",(0,s.jsx)(n.code,{children:"*.domain.com"})," and ",(0,s.jsx)(n.code,{children:"domain.com"}),", as you need to provide 2 values for the same TXT ",(0,s.jsx)(n.code,{children:"_acme-challenge.domain.com"})," record (to answer both the ",(0,s.jsx)(n.code,{children:"*.domain.com"})," and ",(0,s.jsx)(n.code,{children:"domain.com"})," challenge responses)."]}),"\n",(0,s.jsx)(n.p,{children:"To use Manual DNS:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Select Manual DNS as your DNS update method"}),"\n",(0,s.jsx)(n.li,{children:"Perform your initial certificate request. The request will pause and ask you to create a TXT record in your domain (one value for each domain or wildcard). Once you have completed that, wait for your DNS name servers to complete propagation. If you have trouble validating, wait an hour or more for this to complete."}),"\n",(0,s.jsx)(n.li,{children:"Use 'Request Certificate' to resume the request and check validation."}),"\n",(0,s.jsx)(n.li,{children:"If the certificate authority can see the TXT value they asked for in your DNS, they will then allow a certificate to be issued and the request will resume as normal."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"common-issues",children:"Common Issues"}),"\n",(0,s.jsx)(n.h3,{id:"dns-domain-validations-suddenly-failing",children:"DNS domain validations suddenly failing"}),"\n",(0,s.jsx)(n.p,{children:"DNS providers can and do change their APIs periodically which can impact renewals using DNS validation. For instance, GoDaddy changed their API to only allow API use for customers with more than 10 domains. Other DNS providers have retired their older APIs resulting in renewals that use those failing. We recommend that if a problem develops with DNS validation that you ensure you are using the latest version of the app and if the problem persists contact your DNS provider to ask if their API has recently changed."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>t,x:()=>r});var i=o(6540);const s={},a=i.createContext(s);function t(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);